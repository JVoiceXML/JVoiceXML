<project name="JVoiceXML system test Run Script" default="run" basedir=".">
    <description>
This file provides targets to run and stop the voice browser.
  </description>

    <import file="build.xml" />

    <target name="-run-setup" depends="-setup">
        <property name="servlet.project" value="../org.jvoicexml.systemtest.servlet" />
        <property name="results.dir" value="./irtest/results" />
        <path id="run.classpath">
            <path refid="project.classpath" />
            <fileset refid="loggings.lib" />
            <fileset refid="spring.lib" />
            <pathelement location="${dist}/jvxml-client-text.jar" />
            <pathelement location="${dist}/jvxml-text.jar" />
            <pathelement path="${build}" />
            <pathelement path="./config" />
            <pathelement path="${config}" />
        </path>
    </target>
    
    <target name="-init" depends="-run-setup">
        <!-- Create results directories -->
        <mkdir dir="${results.dir}" />
        <copy file="./config/ir.xslt" tofile="${results.dir}/ir.xslt" />
    </target>
    
    <target name="stopTomcat" depends="-run-setup">
        <ant antfile="${servlet.project}/build.xml" 
            dir="${servlet.project}" target="shutdownTomcat"
            inheritAll="false"/>
    </target>
    
    <target name="startTomcat" depends="-run-setup">
        <ant antfile="${servlet.project}/build.xml" 
            dir="${servlet.project}" target="startupTomcat"
            inheritAll="false"/>
    </target>
    
    <target name="prepareConfig" depends="-run-setup">
        <replace file="${jvxml.core.dir}/personal-props/ant.properties" 
            token="jvxml.text = false" 
            value="jvxml.text = true"/>
        <ant antfile="${jvxml.core.dir}/configuration.xml" 
            dir="${jvxml.core.dir}"
        	target="createConfiguration" 
            inheritAll="false"/>
        <replace file="${jvxml.core.dir}/config/implementation.xml" 
            token="value=&quot;1" 
            value="value=&quot;1000" />
        <copy file="${jvxml.core.dir}/etc/run.xml" tofile="${jvxml.core.dir}/run.xml" />
        <copy file="./config/log4j-SocketHub.xml" tofile="${jvxml.core.dir}/config/log4j.xml" />
    </target>

    <target name="-parallel.task" description="system test parallel task" 
        depends="-run-setup">
        <parallel timeout="3600000" failonany="false">
            <sequential>
                <echo message="start jvoice xml interpreter." />
                <ant antfile="${jvxml.core.dir}/run.xml" 
                    dir="${jvxml.core.dir}"
                	target="run" 
                    inheritAll="false"/>
            </sequential>
            <sequential>
                <echo message="start jvoice xml system test." />
                <ant antfile="run.xml"
                    dir="."
                	target="run"/>
                <sleep seconds="10" />
            </sequential>
        </parallel>
    </target>
    
    <target name="run" description="Auto Run the VoiceXML interpreter system test"
        depends="-init, prepareConfig, startTomcat, -parallel.task, stopTomcat"
        />
</project>
