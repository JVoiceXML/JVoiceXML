<project name="configuration generator" basedir="."
    default="createConfiguration">
    <description>
This file creates a custom configuration for JVoiceXml.

It creates a run.xml ANT build file with the configured components and
adapts the configuration files to match the configured components.

To override the current settings follow the instructions given in
personal-props/README.txt
  </description>

    <!-- allow the user to override setting in an own propertiesfile. -->
    <property file="personal-props/ant.properties" />
    <property file="config-props/ant.properties" />

    <target name="-setup">
        <!-- directory structure -->
        <property name="dist" value="dist" />
        <property name="config" value="config" />
        <property name="etc" value="etc" />

        <!-- Properties for components to use -->
        <condition property="jvxml.text.use">
            <istrue value="${jvxml.text}" />
        </condition>
        <condition property="jvxml.jsapi20.use">
            <istrue value="${jvxml.jsapi20}" />
        </condition>

        <copy file="${etc}/run.xml" todir="." overwrite="true"/>
        <copy file="${etc}/implementation.xml" todir="${config}"
            overwrite="true"/>
    </target>

    <target name="-adaptConfiguration" depends="-setup">
        <copy file="${etc}/phone1" todir="${config}" />
        <replace file="${config}/phone1">
            <replacefilter token="@sip.address@" value="${sip.address}" />
        </replace>
        <xslt in="${etc}/callmanager.xml"
          out="${config}/callmanager.xml"
          style="${etc}/patch-callmanager.xsl">
            <outputproperty name="method" value="xml" />
            <outputproperty name="standalone" value="no" />
            <outputproperty name="encoding" value="UTF-8" />
            <outputproperty name="indent" value="yes" />
            <param name="terminal" expression="${sip.terminal}" />
            <param name="port" expression="${sip.port}" />
        </xslt>
    </target>

    <target name="-patchComponent">
        <echo>Adding component ${component}</echo>
        <xslt in="run.xml"
          out="run-tmp.xml"
          style="../${component}/etc/patch-runscript.xsl">
            <outputproperty name="method" value="xml" />
            <outputproperty name="standalone" value="no" />
            <outputproperty name="encoding" value="UTF-8" />
            <outputproperty name="indent" value="yes" />
            <param name="distpath" expression="${dist}" />
            <param name="thirdrdparty" expression="../${component}/3rdparty" />
        </xslt>
        <copy file="run-tmp.xml" tofile="run.xml" />
        <delete file="run-tmp.xml"/>
        <xslt in="${config}/implementation.xml"
          out="${config}/implementation-tmp.xml"
          style="../${component}/etc/patch-implementation.xsl">
            <outputproperty name="method" value="xml" />
            <outputproperty name="standalone" value="no" />
            <outputproperty name="encoding" value="UTF-8" />
            <outputproperty name="indent" value="yes" />
        </xslt>
        <copy file="${config}/implementation-tmp.xml"
            tofile="${config}/implementation.xml" />
        <delete file="${config}/implementation-tmp.xml"/>
    </target>

    <target name="-patchTextImplementation" depends="-setup"
        if="jvxml.text.use">
        <antcall target="-patchComponent">
            <param name="component" value="org.jvoicexml.implementation.text"/>
        </antcall>
    </target>

    <target name="-patchJsapi20Implementation" depends="-setup"
        if="jvxml.jsapi20.use">
        <antcall target="-patchComponent">
            <param name="component" value="org.jvoicexml.implementation.jsapi20"/>
        </antcall>
    </target>

    <target name="-patchComponents"
       depends="-patchTextImplementation,-patchJsapi20Implementation"/>

    <target name="createConfiguration"
       depends="-setup,-adaptConfiguration,-patchComponents"/>
</project>
