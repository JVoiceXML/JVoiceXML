\documentclass[11pt,a4paper]{article}

%
% $Id: howtobuild.tex,v 1.14 2006/04/25 14:20:24 schnelle Exp $
%

\usepackage[latin1]{inputenc}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{url}
\usepackage{listings}
\usepackage{xcolor}

\title{How to build JVoiceXML \\
Version 1.8}

\author{Dirk Schnelle,  \\
  \texttt{dirk.schnelle@jvoicexml.org} } 

\date{}

\begin{document}
\pagestyle{headings}
\lstset{language=Java,language=XML,
        backgroundcolor=\color{lightgray},
        basicstyle=\small,
        numbers=left,
        numberstyle=\tiny,
        stepnumber=5}

\maketitle

\begin{abstract}
This documents describes the steps you have to perform, when you want
to build JVoiceXML or develop code for the JVoiceXML project. It gives
information about the requirements of your development environment 
and our coding conventions.
\end{abstract}

\section{Introduction}
\label{sec:introduction}

JVoiceXML is a free VoiceXML~\cite{w3.org:voicexml} implementation written in 
the JAVA programming language. It offers a library for easy VoiceXML
document creation and a VoiceXML interpreter to process 
VoiceXML documents using JAVA standard APIs such as JSAPI~\cite{sun:jsapi} and
JTAPI~\cite{sun:jsapi}.

VoiceXML is hosted at SourceForge~\cite{sourceforge} as an open source project.
You find everything that is related to this project under
\url{http://sourceforge.net/projects/jvoicexml/}.

This document refers to UNIX and Windows systems. JVoiceXML will work 
any other operating systems that support Java 5, too.

Nobody is perfect, so you may find some errors or small things to correct.
Please let me know if you think you found something that should be written
differently.

\section{Copyright}
\label{sec:copyright}

JVoiceXML uses the GNU library general public license~\cite{gnu:lgpg}. 
This is mentioned in all our source files as a unique header, see
section~\ref{sec:code-conventions}.
You can find a copy in the file COPYING in the \$\{JVOICEXML\_HOME\}
directory. This means that you are allowed to use JVoiceXML
library in your commercial programs. If you make some nice
enhancements it would be great, if you could send us your
modifications so that we can make it available to the public.

JVoiceXML is free software; you can redistribute it and/or
modify it under the terms of the GNU Library General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later version.

JVoiceXML is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Library General Public License for more details.

You should have received a copy of the GNU Library General Public
License along with this library; if not, write to the Free
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

\section{Download the source code}

\subsection{Download the source archive}

You can download a the source code for the available releases from 
\url{http://jvoicexml.sourceforge.net/downloads.htm}.
Create a directory JVoice\-XML and unpack the zipped source file into it.
In the rest of this document this directory will be referred as
\$\{JVOICE\-XML\_HOME\}.

\begin{lstlisting}
mkdir JVoiceXML
cd JVoiceXML
unzip jvxml-src-VERSION.zip
\end{lstlisting}

\texttt{VERSION} has to be replace by the used version number, e.g. 0.5.

Note that the third party libraries are not part of this zip archive.
You should download the libraries from their original location,
download them from our cvs repository, see 
section~\ref{sec:cvs-repository}, or download the binary distribution.
All used libraries are located in the \texttt{lib} folder of
your JVoiceXML installation. Just create a directory 
\texttt{3rdparty} and copy all jars to this folder.

\begin{lstlisting}
mkdir 3rdparty
cp JVOICEXML_HOME/lib/*.jar 3rdparty
\end{lstlisting}

Note that you will have to adapt the lib properties of the build file
if you just copy the jars.

\subsection{SVN repository}
\label{sec:cvs-repository}

If you want to stay at the current state of development you have to use
the SVN repository from Source Forge~\cite{sourceforge}.
This is also the preferred way.

The trunk contains several projects:
\begin{description}
\item[org.jvoicexml] The core of the interpreter (Required)
\item[org.jvoicexml.implementation.jsapi20] Demo implementation platform for
JSAPI 2.0~\cite{jcp:jsr113}.
\item[org.jvoicexml.implementation.text] Demo implementation platform for
text based access.
\item[org.jvoicexml.eclipse.jst.server] Eclipse plugin to start the JVoiceXml
from the eclipse server view.
\item[org.jvoicexml.eclipse.features] Eclipse features for the JVoiceXml
plugin.
\item[org.jvoicexml.eclipse.updatesite] Eclipse update site for the
JVoiceXml plugin
\item[documentation] \LaTeX sources for the documentation
\end{description}

This section describe the parameters to access the SVN repository 
using the command line. Feel free to grab the required parameters from
this description and feed your favourite tool with them.

\begin{lstlisting}
svn co \
https://jvoicexml.svn.sourceforge.net/svnroot/jvoicexml/trunk
\end{lstlisting}

This will check out all the projects of the \texttt{trunk}.
Since all the third party libraries are checked in this may
take a while.

\textbf{Note:} UNIX file and directory names are case sensitive.

\section{Directory structure}
\label{sec:directory-structure}

Having the source code in your \$\{JVOICEXML\_HOME\} directory you
find the following directory structure:

\begin{description}
\item[3rdparty] third party libraries
\item[classes] compiled binaries
\item[config] configuration setting to run the voice browser
\item[config-props] configuration templates for the ant build files
\item[demo] demo programs
\item[dist] distribution files
\item[doc] documentation
\item[etc] resource files
\item[personal-props] adapted configuration from the configuration templates
for the ant build files
\item[src] Java source code
\item[test] JUnit tests and other tests
\item[3rdparty-libs.xml] ANT setting for the third party libraries
\item[build.xml] main ANT build file
\item[configuration.xml] ANT build file to create a customized configuration
\item[distribution.xml] ANT build file to create the distribution
\item[run.xml] ANT build file to run the voice browser
\item[test.xml] ANT build file to to run the unit tests
\end{description}

Not all of the files are present at start but are created by the
ANT build file or through procedures described in this 
document, see section~\ref{sec:ant-build-file}.

\section{Required Software}
\label{sec:required-software}

Since JVoiceXML is written in JAVA you will at least need a
JAVA compiler~\ref{sec:ide}, an editor or preferably a JAVA
IDE, see section~\ref{sec:ide}, and ANT, see section~\ref{sec:ant}, to build the
binaries. All used third party libraries can be downloaded from the CVS 
repository or from their home pages.

\subsection{IDE}
\label{sec:ide}

You can use the IDE of your choice to edit the sources and compile the 
binaries. You can even use a simple text editor to perform this job.
Nevertheless there are some restriction that you cannot work around.

Your IDE must support

\begin{itemize}
\item J2SE 1.5
\item ANT 1.7
\end{itemize}

\subsection{JAVA}
\label{sec:java}

Parts of the code of JVoiceXML are using features from the JAVA 5 API, so that
you will need at least J2SE 1.5 to compile the code. You can download it
for free from \url{http://java.sun.com/j2se/1.5.0/download.jsp}.

\subsection{ANT}
\label{sec:ant}

JVoiceXML is being built by an ANT build file It is recommended that
you use at least ANT 1.7.0. 
If you don't have ANT installed, you can download the current release
from \url{http://ant.apache.org}.

The build file allows you to override the settings by using a custom 
properties file jvoicexml.properties in the \$\{JVOICEXML\_HOME\}
directory.

Nearly all IDE's feature an ANT integration. This allows to use
your favorite IDE.

\subsubsection{Adapting the ANT configuration}

This directory \texttt{personal-props} provides a developer with the 
possibility to override any 
default properties defined by files in \texttt{config-props}. 
Any file that is to be
substituted must be copied from \texttt{config-props} 
(preserving the directory structure) to that directory and can then be 
modified.

The CLASSPATH settings in the build.xml files assure that the files
found in this directory have precedence over those in config-props.

\subsection{Third party libraries}
\label{sec:third-party-libr}

JVoiceXML uses some third party libraries. This section names them and tell
you where you can get them. All of them are at least freeware
so that it was possible to store them in the SVN repository at
SourceForge. You can download them either from that location or
from their home pages. 

In this section, only those libraries are described, that are required
to build the main project. The demos may require additional libraries.

You can also use your local copy by adjusting the settings in your
custom properties file.

The settings of these libraries are stored in the file \emph{3rdparty-libs.xml}
which is imported by the main build file.

All third party libraries are located in the directory \\
\$\{JVOICEXML\_HOME\}/3rdparty.

This directory is assigned to the property \\
\texttt{3rdparty.dir}

Each library is located in a specific subfolder of the \$\{3rdparty.dir\}
folder. These subfolder follow this convention:

\begin{itemize}
\item The name of the subfolder is a combination of the library name and
the version of this library, i.e. \texttt{log4j1.2.15} for the \emph{log4j}
library with the version number\emph{1.2.15}.
\item The jars of this library are located in a subfolder of this folder
called \emph{lib}
\item The JAVADOC documentation for the library is compressed into a zip
archive and added to the subfolder.
\end{itemize}

\subsubsection{Libraries needed to compile JVoiceXML}
\label{sec:libr-need-comp}

\paragraph{log4j 1.2.15}

JVoiceXML uses log4j~\cite{apache:log4j} for logging. We think that log4j has 
some advantages
over \texttt{java.util.logging} and appears to be more mature and reliable.

\paragraph{JSAPI 1.0}

JVoiceXML uses the Java Speech API v1.0 (JSAPI)~\cite{sun:jsapi} to address 
speech recognition and speech synthesis issues.

\paragraph{JSAPI 2.0}

The JSAPI 2.0 specification is under going changes.
JSAPI 2.0 is deing developed within
the Java Community Process (JCP)~\cite{jcp} under 
JSR-113~\cite{jcp:jsr113}. Since the jar is copyrighted and must be downloaded
from conversay's web page conversations~\cite{conversay:jsr113}
this library is optional. The
build file will check for existence of the jar file and omit the corespondent compilation
steps if it can not be found..

\paragraph{FreeTTS 1.2a}

JVoiceXML uses FreeTTS~\cite{freetts} as a demo implementation for TTS output.

Note that the used library is a snampshot from the FreeTTS svn repository.

\paragraph{CMU sphinx 4}

JVoiceXML uses sphinx 4~\cite{sphinx} from Carnegie Mellon University
as a demo implementation for speech recognition.

Note that the used library is a snampshot from the FreeTTS svn repository.

\paragraph{Spring Framework 2.0.7}
\label{sec:spring-framework}

JVoiceXML uses the spring framework to address configuration
issues.

\paragraph{Rhino 1.6R7}

JVoiceXML uses rhino~\cite{rhino} from Mozilla to enable scripting.
This will be replaced once we rely on Java 6.

\paragraph{Commons pool 1.3}

The pooling of implementation platform resources is based on commons
pool.

\paragraph{JTAPI 1.3}

JTAPI is used to address telephony issues.

\paragraph{GJTAPI 1.8}

GJTAPI is used to simply the use of the JTAPI layer.

Note that the used library is a modified version. Modifications include
\begin{itemize}
\item bug fixes of the SIP provider
\end{itemize}

\paragraph{jlibrtp 0.2}

jlibrtp is used to enable streaming of audio data via the RTP protocol.

Note that the used library is a snampshot from the FreeTTS svn repository.

\subsubsection{Libraries needed at run-time}

Besides the libraries named in section~\ref{sec:libr-need-comp} the following
libraries are needed to run JVoiceXML.

\paragraph{Commons Logging 1.0.4}
\label{sec:commons-logging}

JVoiceXML uses the spring framework~\ref{sec:spring-framework} to address 
configuration
issues. Commons logging is needed at run-time.

\paragraph{JainSIP 1.1}

Required for the SIP protocol using gjtapi.

\paragraph{stun4j}

Required by JainSIP.

\section{The ANT build file}
\label{sec:ant-build-file}

JVoiceXML uses ANT to build the binaries and the documentation. 

\subsection{Creating a configuration}

Currently there are two demo implementations for the implementation platform
that reside in co-projects, refer to section~\ref{sec:cvs-repository}.

If you want to use one of them, you have to adapt the corresponding setting
in your copy of \texttt{ant.properties} in thhee folder \texttt{personal-props}.
This setting is also used if you call ant for the main build file as described
in the following section.

Once you changed te settings call
\begin{lstlisting}
ant -buildfile configuration.xml
\end{lstlisting}
to create your adapted configuration settings. In addition you also get
a customized ant build file \texttt{run.xml} to start and stop the interpreter
using the libraries from the co-projects.

\subsection{The main build file}

This section explains the most important targets of the main build file
\texttt{build.xml}. Just start ant without any target specified if you want to
build everything. Call 
\begin{lstlisting}
ant -projecthelp
\end{lstlisting}
to get an overview of the targets and their purpose.

Some of the targets use third party extensions to ANT. These 
extensions are not described in this document, but are part of
the 3rdparty folder. In contrast to the libraries to link with,
these libraries are not defined in the file 3rdparty-libs.xml
but in the corresponding target of this build file. Each features
a preceding target that checks if the library is required. If
the library is not found, the target will not be called.

\begin{description}
\item[clean]
Delete all compiled class files in the directory \emph{classes}
and the jars that are created by the \emph{jar} target in the directory 
\emph{dist}.

\item[compile]
 Compile all JAVA files in the directory \emph{src} into the directory
\emph{classes}.

\item[jar]
 This target depends on the target \emph{compile} and creates the jar
files of your distribution in the directory \emph{dist}.
If successful, you will find the following jar archives:
\begin{itemize}
\item jvxml.jar This jar file contains the core of JVoiceXML.
\item jvxml-xml.jar This jar contains all files that are required
to create and parse VoiceXML documents.
\item jvxml-jsapi1.0.jar This jar contains a core implementation platform
based on JSAPI 1.0.
\item jvxml-jsapi1.0-impl.jar This jar contains a demo implementation
platform for JSAPI 1.0 using sphinx and FreeTTS.
\item jvxml-client.jar This jar contains the files needed to build
a client.
\item jvxml-jtapi1.3.jar This jar contains a basic telephony layer using
JTAPI 1.3.
\item some other jars, depending on your configuration settings
\end{itemize}

\item[apidoc]
Create JAVADOC documentation from the JAVA files in the directory
doc/api.
\item[checkstyle]
Perform a check of the JVoiceXML coding standard as specified 
in section~\ref{sec:code-conventions}.
\end{description}

Call
\begin{lstlisting}
ant <target>
\end{lstlisting}
to run ant for the the given target.

\section{Code conventions}
\label{sec:code-conventions}

We follow the JAVA code conventions~\cite{sun:codeconv} for our code. All
methods and member variables must be commented using 
JAVADOC~\cite{sun:javadoc_guidelines}.

In addition we use a custom \texttt{@todo} JAVADOC tag to mark
sections that need further work.

Example:

\begin{lstlisting}[language=Java]
/** @todo Implement the untreated case XYZ */
\end{lstlisting}

We use checkstyle~\cite{checkstyle} to check our coding conventions.
All developers are requested to execute the \emph{checkstyle} target
of our ANT buildfile~\ref{sec:ant-build-file}. 
There are plugins for some IDEs, which you can use if you want to. The
\texttt{checkstyle.xml} can be found in the folder 
\texttt{etc/checkstyle4.1} and is called \texttt{jvoicexml-checks.xml}.

Developers are requested to use the \texttt{\{@inheritDoc\}} JAVADOC
tag in favor of a \texttt{@see} reference for inherited documentation.
Pros of the \texttt{\{@inhe\-rit\-Doc\}} tag, taken 
from~\cite{tauber:inheritdoc}, are
\begin{itemize}
\item satisfies checkstyle requirements for JAVADOC,
\item no references to go stale,
\item additional doc specific to this implementation will appear in JAVADOC and
\item inherited doc in JAVADOC.
\end{itemize}

All source files must contain the following header about the 
copyright, see section~\ref{sec:copyright}, that we use for JVoiceXML.

\begin{lstlisting}[language=Java]
/*
 * File:    $HeadURL$
 * Version: $LastChangedRevision$
 * Date:    $LastChangedDate $
 * Author:  $LastChangedBy$
 *
 * JVoiceXML - A free VoiceXML implementation.
 *
 * Copyright (C) 2007 JVoiceXML group - 
 *      http://jvoicexml.sourceforge.net
 *
 * This library is free software; you can redistribute it 
 * and/or modify it under the terms of the GNU Library 
 * General Public License as published by the Free Software 
 * Foundation; either version 2 of the License, or (at your 
 * option) any later version.
 *
 * This library is distributed in the hope that it will be 
 * useful, but WITHOUT ANY WARRANTY; without even the 
 * implied warranty of MERCHANTABILITY or FITNESS FOR A 
 * PARTICULAR PURPOSE.  See the GNU Library General Public 
 * License for more details.
 *
 * You should have received a copy of the GNU Library 
 * General Public License along with this library; if 
 * not, write to  the Free Software Foundation, Inc., 
 * 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 */
\end{lstlisting}

The keywords embarrassed by \texttt{\$} are to be expanded by 
subversion. 
This means that for any \texttt{svn commit} the subversion
option \texttt{svn:keywords} has to be set by

\begin{lstlisting}
svn propset svn:keywords "HeadURL LastChangedRevision \
LastChangedDate LastChangedBy" <filename>
\end{lstlisting}.

Since this has to be done for each file, you might want to have a look
at the SVN's automatic property setting capability.

In order to activate it, locate the \texttt{config} file in you subversion home
folder and open it for editing.

In the section \texttt{[miscellany]} set
\begin{lstlisting}
enable-auto-props = yes
\end{lstlisting}

In the section \texttt{[auto-props]} set
\begin{lstlisting}
*.java = svn:mime-type=text/plain;svn:eol-style=native;svn:\
keywords=Date Author Id Revision HeadURL Revision \
LastChangedRevision LastChangedBy
\end{lstlisting}

The class comment has to contain the following information:

\begin{lstlisting}[language=Java]

/**
 * Comment about the purpose of this class.
 *
 * @author <Name of the author>
 *
 * @version $LastChangedRevision$
 * @since <current version number>
 */
\end{lstlisting}

Again the keyword expansion from subversion is used to expand the keyword,
\texttt{\$LastChangedRevision \$} in this case. The name of the author and the 
purpose have to be replaced by their proper values.

\section*{Document history}

\begin{tabular}{|l|p{5cm}|l|l|}
\hline
\textbf{Version} & \textbf{Comment} & \textbf{Author} & \textbf{Date} \\
\hline
\hline
0.1 & Initial Release & Dirk Schnelle & 20/01/2005 \\
\hline
0.1 & Review & Steven Doyle & 20/01/2005 \\
\hline
1.0 & Release & Dirk Schnelle & 20/01/2005 \\
\hline
1.1 & Added copyright notice in Java source files.
Added TortoiseCVS part for Windows.
Added third party libraries. & Dirk Schnelle & 
 02/05/2005 \\
\hline
1.1 & Review & Steven Doyle & 12/05/2005 \\
\hline
1.1 & Release & Dirk Schnelle & 12/05/2005 \\
\hline
1.2 & Added commons libraries & Dirk Schnelle & 03/06/2005 \\
\hline
1.2 & Review & Steven Doyle & 30/06/2005 \\
\hline
1.2 & Release & Dirk Schnelle & 05/07/2005 \\
\hline
1.3 & Adaption to new build file structure, Updated checkstyle, added 
inheritDoc & Dirk Schnelle & 21/11/2005 \\
\hline
1.3 & Review & Steven Doyle & 23/11/2005 \\
\hline
1.3 & Release & Dirk Schnelle & 24/11/2005 \\
\hline
1.5 & Adaption to 0.4.1  & Dirk Schnelle & 24/04/2006 \\
\hline
1.5.1 & Review & Ingimar  & 04/25/2006 \\
\hline
1.5.1 & Release  & Dirk Schnelle & 25/04/2006 \\
\hline
1.6 & Adaption to 0.5  & Dirk Schnelle & 24/04/2006 \\
\hline
1.7 & Worked on library descriptions  & Dirk Schnelle & 08/01/2008 \\
\hline
1.8 & Adapted to reorganisation of the project structure & Dirk Schnelle &
30/05/2008 \\
\hline
\end{tabular}


\bibliography{howtobuild}
\bibliographystyle{plain}


\end{document}

% LocalWords:  JVoiceXML VoiceXML APIs JSAPI JTAPI mkdir cd CVS SourceForge cvs
% LocalWords:  pserver CVSROOT acls RSH lll xml LGPL src api JAVADOC rdparty XP
% LocalWords:  IDE jvoicexml dir JCP JSR jsapi BCL chmod FreeTTS TTS freetts
% LocalWords:  jvxml impl todo XYZ checkstyle Schnelle howtobuild basicstyle
% LocalWords:  RFE numberstyle stepnumber kkv href Revison JVoice Adrindam Das
% LocalWords:  TortoiseCVS cygwin  CMU tex schnelle WSJ gau dCep mel Mozilla
% LocalWords:  projecthelp backgroundcolor lightgray subfolder lang buildfile
% LocalWords:  plugins IDEs inheritDoc inhe rit RCSfile login apidoc loggings
% LocalWords:  distributionFolder IDE's Ingimar SVN svn trunc HTTPS config RTP
% LocalWords:  CLASSPATH GJTAPI jlibrtp JainSIP gjtapi HeadURL LastChangedDate
% LocalWords:  LastChangedRevision LastChangedBy propset
