<project name="configuration generator" basedir="."
    default="createConfiguration">
    <description>
This file creates a custom configuration for JVoiceXml.

It creates a run.xml ANT build file with the configured components and
adapts the configuration files to match the configured components.

To override the current settings follow the instructions given in
personal-props/README.txt
  </description>

    <!-- allow the user to override setting in an own propertiesfile. -->
    <property file="personal-props/ant.properties" />
    <property file="config-props/ant.properties" />

    <target name="-setup">
        <!-- directory structure -->
        <property name="dist" value="dist" />
        <property name="config" value="config" />
        <property name="etc" value="etc" />

        <!-- Properties for components to use -->
        <condition property="jvxml.text.use">
            <istrue value="${jvxml.text}" />
        </condition>
        <condition property="jvxml.jsapi10.use">
            <istrue value="${jvxml.jsapi10}" />
        </condition>
        <condition property="jvxml.jsapi20.use">
            <istrue value="${jvxml.jsapi20}" />
        </condition>
        <condition property="jvxml.jtapi.use">
            <istrue value="${jvxml.jtapi}" />
        </condition>
      <condition property="jvxml.mrcpv2.use">
          <istrue value="${jvxml.mrcpv2}" />
      </condition>

      <!-- 
        - Prepare the files that can be changed by the implementation platforms 
        -->
      <copy file="${etc}/run.xml" todir="." overwrite="true"/>
      <copy file="${etc}/implementation.xml" todir="${config}"
          overwrite="true"/>
      <copy file="${etc}/grammar.xml" todir="${config}"
          overwrite="true"/>
      <delete dir="${config}">
        <include name="*-implementation.xml"/>
        <include name="*-callmanager.xml"/>
      </delete>
    </target>

    <target name="-patchComponent">
        <echo>Adding component ${component}</echo>
        <xslt in="run.xml"
          out="run-tmp.xml"
          style="../${component}/etc/patch-runscript.xsl">
            <outputproperty name="method" value="xml" />
            <outputproperty name="standalone" value="no" />
            <outputproperty name="encoding" value="UTF-8" />
            <outputproperty name="indent" value="yes" />
            <param name="distpath" expression="${dist}" />
            <param name="thirdparty" expression="../${component}/3rdparty" />
        </xslt>
        <copy file="run-tmp.xml" tofile="run.xml" overwrite="true"/>
        <delete file="run-tmp.xml"/>
        <xslt in="${config}/implementation.xml"
          out="${config}/implementation-tmp.xml"
          style="../${component}/etc/patch-implementation.xsl">
            <outputproperty name="method" value="xml" />
            <outputproperty name="standalone" value="no" />
            <outputproperty name="encoding" value="UTF-8" />
            <outputproperty name="indent" value="yes" />
        </xslt>
        <copy file="${config}/implementation-tmp.xml"
            tofile="${config}/implementation.xml" overwrite="true"/>
        <delete file="${config}/implementation-tmp.xml"/>
    </target>

    <target name="-patchTextImplementation" depends="-setup"
        if="jvxml.text.use">
      <ant antfile="../org.jvoicexml.implementation.text/build.xml"
        target="configuration" inheritall="false"/>
    </target>

    <target name="-patchJsapi10Implementation" depends="-setup"
        if="jvxml.jsapi10.use">
      <ant antfile="../org.jvoicexml.implementation.jsapi10/build.xml"
        target="configuration" inheritall="false"/>
    </target>

    <target name="-patchJsapi20Implementation" depends="-setup"
        if="jvxml.jsapi20.use">
      <ant antfile="../org.jvoicexml.implementation.jsapi20/build.xml"
        target="configuration" inheritall="false"/>
    </target>

    <target name="-patchJtapiImplementation" depends="-setup"
        if="jvxml.jtapi.use">
      <ant antfile="../org.jvoicexml.implementation.jtapi/build.xml"
        target="configuration" inheritall="false"/>
    </target>

  <target name="-patchMrcpv2Implementation" depends="-setup"
      if="jvxml.mrcpv2.use">
      <antcall target="-patchComponent">
          <param name="component" value="org.jvoicexml.implementation.mrcpv2"/>
      </antcall>
  </target>

    <target name="-patchComponents"
       depends="-setup,-patchTextImplementation,-patchJsapi10Implementation,-patchJsapi20Implementation,-patchJtapiImplementation,-patchMrcpv2Implementation"/>

    <target name="createConfiguration"
       depends="-setup,-patchComponents"/>
</project>
